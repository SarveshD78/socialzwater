{% extends 'campaign/base.html' %}
{% load static %}

{% block page_title %}Campaign Reports{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item active">Reports</li>
{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary: #667eea;
        --primary-dark: #764ba2;
        --success: #48bb78;
        --danger: #f56565;
        --warning: #ed8936;
        --info: #4299e1;
        --bg-card: #ffffff;
        --text-primary: #2d3748;
        --text-secondary: #718096;
        --border: #e2e8f0;
    }

    .page-header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .page-title {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .page-subtitle {
        font-size: 1rem;
        opacity: 0.9;
    }

    .search-section {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .reports-table {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .table {
        margin-bottom: 0;
    }

    .table thead th {
        background: #f7fafc;
        border-bottom: 2px solid var(--border);
        color: var(--text-primary);
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
        padding: 1rem;
    }

    .table tbody td {
        padding: 1rem;
        vertical-align: middle;
        color: var(--text-secondary);
    }

    .table tbody tr {
        transition: background-color 0.2s ease;
    }

    .table tbody tr:hover {
        background-color: #f7fafc;
    }

    .campaign-name {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 1rem;
    }

    .client-name {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
    }

    .metric-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
    }

    .metric-badge.scans {
        background: #e6f3ff;
        color: #2563eb;
    }

    .metric-badge.submissions {
        background: #d4f4dd;
        color: #16a34a;
    }

    .progress-wrapper {
        margin-bottom: 0.5rem;
    }

    .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.25rem;
        font-size: 0.75rem;
        color: var(--text-secondary);
    }

    .progress {
        height: 8px;
        border-radius: 4px;
        background-color: #f0f0f0;
    }

    .progress-bar {
        border-radius: 4px;
        transition: width 0.6s ease;
    }

    .progress-bar.conversion {
        background: linear-gradient(90deg, #48bb78, #68d391);
    }

    .progress-bar.completion {
        background: linear-gradient(90deg, #4299e1, #63b3ed);
    }

    .performance-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .performance-indicator.excellent {
        background: #d4f4dd;
        color: #16a34a;
    }

    .performance-indicator.good {
        background: #e6f3ff;
        color: #2563eb;
    }

    .performance-indicator.average {
        background: #fef3c7;
        color: #d97706;
    }

    .performance-indicator.poor {
        background: #fee2e2;
        color: #dc2626;
    }

    .btn-view-report {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-view-report:hover {
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: var(--bg-card);
        border-radius: 12px;
        border: 1px solid var(--border);
    }

    .empty-icon {
        font-size: 4rem;
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
    }

    .empty-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .empty-text {
        color: var(--text-secondary);
    }

    @media (max-width: 768px) {
        .table-responsive {
            font-size: 0.875rem;
        }
        
        .btn-view-report {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Campaign Reports</h1>
    <p class="page-subtitle">View detailed analytics and performance metrics for {{ total_campaigns }} campaign{{ total_campaigns|pluralize }}</p>
</div>

<div class="search-section">
    <form method="get" action="{% url 'sw:report_list' %}">
        <div class="row g-3">
            <div class="col-md-10">
                <input type="text" 
                       name="search" 
                       class="form-control" 
                       placeholder="Search by campaign name, client, or area..." 
                       value="{{ search_query }}">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-search me-2"></i>Search
                </button>
            </div>
        </div>
    </form>
</div>

{% if reports %}
<div class="reports-table">
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Campaign</th>
                    <th>Metrics</th>
                    <th>Conversion Rates</th>
                    <th>Performance</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <td>
                        <div class="campaign-name">{{ report.campaign.camp_name }}</div>
                        <div class="client-name">
                            <i class="fas fa-building me-1"></i>
                            {{ report.campaign.client.company_name }}
                        </div>
                    </td>
                    <td>
                        <div class="d-flex flex-column gap-1">
                            <span class="metric-badge scans">
                                <i class="fas fa-qrcode me-1"></i>
                                {{ report.total_scans }} scans
                            </span>
                            <span class="metric-badge submissions">
                                <i class="fas fa-users me-1"></i>
                                {{ report.form_submissions }} submissions
                            </span>
                        </div>
                    </td>
                    <td>
                        <div class="progress-wrapper">
                            <div class="progress-label">
                                <span>Form Conversion</span>
                                <span>{{ report.form_conversion_rate }}%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar conversion" 
                                     style="width: {{ report.form_conversion_rate }}%"></div>
                            </div>
                        </div>
                        <div class="progress-wrapper">
                            <div class="progress-label">
                                <span>Video Completion</span>
                                <span>{{ report.video_completion_rate }}%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar completion" 
                                     style="width: {{ report.video_completion_rate }}%"></div>
                            </div>
                        </div>
                    </td>
                    <td>
                        {% if report.form_conversion_rate >= 30 %}
                            <span class="performance-indicator excellent">
                                <i class="fas fa-star"></i> Excellent
                            </span>
                        {% elif report.form_conversion_rate >= 20 %}
                            <span class="performance-indicator good">
                                <i class="fas fa-thumbs-up"></i> Good
                            </span>
                        {% elif report.form_conversion_rate >= 10 %}
                            <span class="performance-indicator average">
                                <i class="fas fa-minus-circle"></i> Average
                            </span>
                        {% else %}
                            <span class="performance-indicator poor">
                                <i class="fas fa-exclamation-triangle"></i> Needs Work
                            </span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="d-flex gap-2">
                            <a href="{% url 'sw:report_detail' report.campaign.unique_id %}" 
                               class="btn-view-report">
                                <i class="fas fa-chart-line"></i> View Report
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% if reports.has_other_pages %}
<nav aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if reports.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}">First</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ reports.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">Previous</a>
            </li>
        {% endif %}
        
        {% for num in reports.paginator.page_range %}
            {% if reports.number == num %}
                <li class="page-item active">
                    <span class="page-link">{{ num }}</span>
                </li>
            {% elif num > reports.number|add:'-3' and num < reports.number|add:'3' %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}">{{ num }}</a>
                </li>
            {% endif %}
        {% endfor %}
        
        {% if reports.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ reports.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">Next</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ reports.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}">Last</a>
            </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<div class="empty-state">
    <i class="fas fa-chart-bar empty-icon"></i>
    <h2 class="empty-title">No Campaign Reports</h2>
    <p class="empty-text">
        {% if search_query %}
            No campaigns match your search criteria.
        {% else %}
            Create campaigns to start generating reports.
        {% endif %}
    </p>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
    setTimeout(() => {
        location.reload();
    }, 30000);
</script>
{% endblock %}